version: '3.8'

# Production - External Database (Supabase/Cloud)
services:
  # Backend API - Production Mode
  backend:
    build:
      context: .
      dockerfile: Dockerfile
    environment:
      # Database URL from environment (Supabase/external)
      DATABASE_URL: ${DATABASE_URL}
      
      # LLM Configuration
      GEMINI_API_KEY: ${GEMINI_API_KEY}
      GEMINI_MODEL: ${GEMINI_MODEL:-gemini-1.5-flash}
      
      # Analysis Configuration
      TOP_FILES: ${TOP_FILES:-40}
      COMPONENT_COUNT: ${COMPONENT_COUNT:-8}
      CHUNK_SIZE_CHARS: ${CHUNK_SIZE_CHARS:-1400}
      
      # Application Configuration
      WORK_DIR: /tmp/repo-architect
      SQL_DEBUG: ${SQL_DEBUG:-false}
      DEBUG: ${DEBUG:-false}
    ports:
      - "8000:8000"
    volumes:
      - repo_temp:/tmp/repo-architect
    restart: unless-stopped

volumes:
  repo_temp:
